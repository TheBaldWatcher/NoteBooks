# 架构

* 复杂度：业务复杂度（业务类）+质量复杂度（架构类）
  * 鸡蛋篮子理论1：逐渐拆解复杂度
  * 合理平衡内部、外部复杂度。参考：小模块3人，外界交互5个模块
* 可扩展（加新功能）、可伸缩（加资源）
  * 预测变化 -> 封装变化（2年内，更大的变化考虑走重构）
* 性能：单机/集群+计算高性能/存储高性能。鸡蛋篮子理论2：逐渐拆解，直到能承载
  * 单机：
  * 集群：
    * 任务分配/分解：（分解任务）、运行形态（SDK/服务器）、配置获取（文件/中心）、分配算法（权重/负载均衡/分片）
* 可用性：鸡蛋篮子理论3：鸡蛋不要放在一个篮子
  * 计算：任务分配、任务分解
    * 状态检查。运行形态、配置获取、分配算法——和性能类似
  * 存储：replica、一致性
    * 数据复制格式（命令、delta数据、文件）、复制方式（同步、异步、半同步、多数）
    * 可用状态：独裁、协商、投票
* 设计质量：成本、安全性、可观测/可测试/可维护
  * 成本：优化、缓存、加机器、架构优化
  * 安全性：网络隔离、流量清晰、机房切换
  * 可观测、可测试、可维护：
    * 测试：全链路压测、可手动触发
    * 维护：全链路跟踪、支持维护操作（降级，下线，切换）
    * 观测：日志流水、监控平台
  * 设计流程：需求分析、复杂度分析、备选方案、优化（成本、安全、可观测、可维护、可测试）

